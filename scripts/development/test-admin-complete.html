<!DOCTYPE html>
<html lang="pt-BR" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste Completo Admin - Cred30</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['"Plus Jakarta Sans"', 'sans-serif'],
            },
            colors: {
              background: '#09090b',
              surface: '#18181b',
              surfaceHighlight: '#27272a',
              primary: {
                50: '#ecfeff',
                100: '#cffafe',
                200: '#a5f3fc',
                300: '#67e8f9',
                400: '#22d3ee',
                500: '#06b6d4',
                600: '#0891b2',
                700: '#0e7490',
                800: '#155e75',
                900: '#164e63',
              }
            }
          },
        },
      }
    </script>
    <link rel="stylesheet" href="/tailwind-styles.css" />
  </head>
  <body class="bg-background font-sans">
    <div class="min-h-screen p-8">
      <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-white mb-8">Teste Completo do Sistema Admin</h1>
        
        <!-- Status da API -->
        <div class="bg-surface border border-surfaceHighlight rounded-2xl p-6 mb-8">
          <h2 class="text-xl font-bold text-white mb-4">Status da API</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-background p-4 rounded-lg">
              <p class="text-zinc-400 text-sm">Frontend</p>
              <p class="text-emerald-400 font-bold">✓ Rodando</p>
            </div>
            <div class="bg-background p-4 rounded-lg">
              <p class="text-zinc-400 text-sm">Backend</p>
              <p class="text-emerald-400 font-bold">✓ Rodando</p>
            </div>
            <div class="bg-background p-4 rounded-lg">
              <p class="text-zinc-400 text-sm">CSS</p>
              <p class="text-emerald-400 font-bold">✓ Carregado</p>
            </div>
          </div>
        </div>

        <!-- Teste de Login -->
        <div class="bg-surface border border-surfaceHighlight rounded-2xl p-6 mb-8">
          <h2 class="text-xl font-bold text-white mb-4">Teste de Login Admin</h2>
          <div class="space-y-4">
            <input type="email" id="testEmail" placeholder="Email" value="josiassm701@gmail.com" class="w-full bg-background border border-surfaceHighlight rounded-lg px-4 py-2 text-white" />
            <input type="password" id="testPassword" placeholder="Senha" value="senha" class="w-full bg-background border border-surfaceHighlight rounded-lg px-4 py-2 text-white" />
            <input type="text" id="testSecret" placeholder="Frase Secreta" value="kaka" class="w-full bg-background border border-surfaceHighlight rounded-lg px-4 py-2 text-white" />
            <button onclick="testLogin()" class="bg-primary-500 hover:bg-primary-400 text-black font-bold py-2 px-4 rounded-lg">
              Testar Login
            </button>
          </div>
          <div id="loginResult" class="mt-4 p-4 rounded-lg bg-background"></div>
        </div>

        <!-- Teste de API -->
        <div class="bg-surface border border-surfaceHighlight rounded-2xl p-6 mb-8">
          <h2 class="text-xl font-bold text-white mb-4">Teste de API Admin</h2>
          <div class="space-y-4">
            <button onclick="testDashboard()" class="bg-primary-500 hover:bg-primary-400 text-black font-bold py-2 px-4 rounded-lg">
              Testar Dashboard
            </button>
            <button onclick="testProcessAction()" class="bg-emerald-500 hover:bg-emerald-400 text-black font-bold py-2 px-4 rounded-lg">
              Testar Processar Ação
            </button>
          </div>
          <div id="apiResult" class="mt-4 p-4 rounded-lg bg-background"></div>
        </div>

        <!-- Verificação de Componentes -->
        <div class="bg-surface border border-surfaceHighlight rounded-2xl p-6">
          <h2 class="text-xl font-bold text-white mb-4">Verificação de Componentes</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-primary-500 p-4 rounded-lg text-black text-center">
              Botão Primário
            </div>
            <div class="bg-emerald-500 p-4 rounded-lg text-black text-center">
              Botão Emeralda
            </div>
            <div class="bg-red-500 p-4 rounded-lg text-white text-center">
              Botão Vermelho
            </div>
            <div class="bg-yellow-500 p-4 rounded-lg text-black text-center">
              Botão Amarelo
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let authToken = null;

      async function testLogin() {
        try {
          const response = await fetch('http://localhost:3001/api/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: document.getElementById('testEmail').value,
              password: document.getElementById('testPassword').value,
              secretPhrase: document.getElementById('testSecret').value,
            }),
          });

          const data = await response.json();
          
          if (data.success) {
            authToken = data.data.token;
            document.getElementById('loginResult').innerHTML = `
              <div class="text-emerald-400">✓ Login realizado com sucesso!</div>
              <div class="text-zinc-300 text-sm mt-2">Token: ${authToken.substring(0, 20)}...</div>
            `;
          } else {
            document.getElementById('loginResult').innerHTML = `
              <div class="text-red-400">✗ Erro no login: ${data.message}</div>
            `;
          }
        } catch (error) {
          document.getElementById('loginResult').innerHTML = `
            <div class="text-red-400">✗ Erro na requisição: ${error.message}</div>
          `;
        }
      }

      async function testDashboard() {
        if (!authToken) {
          document.getElementById('apiResult').innerHTML = `
            <div class="text-yellow-400">⚠ Faça login primeiro!</div>
          `;
          return;
        }

        try {
          const response = await fetch('http://localhost:3001/api/admin/dashboard', {
            headers: {
              'Authorization': `Bearer ${authToken}`,
            },
          });

          const data = await response.json();
          
          if (data.success) {
            document.getElementById('apiResult').innerHTML = `
              <div class="text-emerald-400">✓ Dashboard carregado com sucesso!</div>
              <div class="text-zinc-300 text-sm mt-2">
                Transações pendentes: ${data.data.pendingTransactions.length}<br>
                Empréstimos pendentes: ${data.data.pendingLoans.length}
              </div>
            `;
          } else {
            document.getElementById('apiResult').innerHTML = `
              <div class="text-red-400">✗ Erro no dashboard: ${data.message}</div>
            `;
          }
        } catch (error) {
          document.getElementById('apiResult').innerHTML = `
            <div class="text-red-400">✗ Erro na requisição: ${error.message}</div>
          `;
        }
      }

      async function testProcessAction() {
        if (!authToken) {
          document.getElementById('apiResult').innerHTML = `
            <div class="text-yellow-400">⚠ Faça login primeiro!</div>
          `;
          return;
        }

        try {
          const response = await fetch('http://localhost:3001/api/admin/process-action', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              id: 'test-id-123',
              type: 'TRANSACTION',
              action: 'APPROVE'
            }),
          });

          const data = await response.json();
          
          if (data.success) {
            document.getElementById('apiResult').innerHTML = `
              <div class="text-emerald-400">✓ Ação processada com sucesso!</div>
              <div class="text-zinc-300 text-sm mt-2">${data.message}</div>
            `;
          } else {
            document.getElementById('apiResult').innerHTML = `
              <div class="text-red-400">✗ Erro ao processar ação: ${data.message}</div>
              <div class="text-zinc-300 text-sm mt-2">Status: ${response.status}</div>
            `;
          }
        } catch (error) {
          document.getElementById('apiResult').innerHTML = `
            <div class="text-red-400">✗ Erro na requisição: ${error.message}</div>
          `;
        }
      }

      // Verificar status inicial
      window.onload = function() {
        console.log('Página de teste carregada');
        console.log('Verificando se todos os componentes estão funcionando...');
      };
    </script>
  </body>
</html>